# Telegram —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫

–ë–æ—Ç —É–º–µ–µ—Ç:
- –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –∞–∫—Ü–∏—é –ø–æ —Ç–∏–∫–µ—Ä—É;
- –≤—ã–¥–∞–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã (SMA20/50, RSI14);
- —Ä–∏—Å–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω—ã + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã;
- –¥–µ–ª–∞—Ç—å AI-–æ–±–∑–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ —Ç–∏–∫–µ—Ä—É (–µ—Å–ª–∏ –µ—Å—Ç—å `OPENAI_API_KEY`);
- –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å;
- —Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫-–º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è: –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –±–µ—Ç–∞ –∫ SPY, VaR 95% (1 –¥–µ–Ω—å);
- —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ SQLite –∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ –∫–Ω–æ–ø–∫–µ `–ú–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å`;
- **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Stooq –∏ SEC EDGAR –ø—Ä–∏ rate limit –æ—Ç Yahoo Finance**.
- **Portfolio Copilot (–±–µ–∑ –∞–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª–∏):** file-based –ø–æ—Ä—Ç—Ñ–µ–ª—å, —Å–∏–≥–Ω–∞–ª—ã BUY/ADD/REDUCE/SELL/HOLD, guardrails, learning loop –∏ Telegram-–Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

## 1) –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
1. –û—Ç–∫—Ä–æ–π—Ç–µ `@BotFather`.
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `/newbot`.
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω.

## 2) –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

## 3) –ù–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env`:
```env
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
OPENAI_API_KEY=–≤–∞—à_openai_api_key   # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
OPENAI_MODEL=gpt-4o-mini
PORTFOLIO_DB_PATH=portfolio.db
PORTFOLIO_STATE_PATH=portfolio_state.json   # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
COPILOT_STORAGE_BACKEND=local               # local | redis
UPSTASH_REDIS_REST_URL=                     # –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ COPILOT_STORAGE_BACKEND=redis
UPSTASH_REDIS_REST_TOKEN=                   # –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ COPILOT_STORAGE_BACKEND=redis
```

## 4) –ó–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º

### ‚ö° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã)

**–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:**
```bash
./start_bot.sh
```
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –±–æ—Ç–∞
- –ó–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
- –°–æ—Ö—Ä–∞–Ω–∏—Ç PID –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –∑–∞–ø—É—â–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
./status_bot.sh
```
–ü–æ–∫–∞–∂–µ—Ç:
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –±–æ—Ç
- PID –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞:**
```bash
./stop_bot.sh
```
–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –±–æ—Ç–∞.

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
```bash
tail -f bot.log
```

### üìù –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
python bot.py
```
‚ö†Ô∏è –ü—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—à–∏–±–∫–∞–º.

## –§–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞ –≤ –±–æ—Ç–µ
### –ê–Ω–∞–ª–∏–∑ –∞–∫—Ü–∏–∏
–ü—Ä–æ—Å—Ç–æ —Ç–∏–∫–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- `AAPL`
- `MSFT`

### –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è
–û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è:
- `TICKER QTY AVG_PRICE`

–ü—Ä–∏–º–µ—Ä:
```text
AAPL 10 170
MSFT 4 320
TSLA 3
```

## –ö–æ–º–∞–Ω–¥—ã –∏ –∫–Ω–æ–ø–∫–∏
- `/start` - —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –º–µ–Ω—é.
- `/help` - —Ñ–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞.
- `/myportfolio` - –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è.
- –ö–Ω–æ–ø–∫–∏: `–ê–Ω–∞–ª–∏–∑ –∞–∫—Ü–∏–∏`, `–ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è`, `–ú–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å`, `–ü–æ–º–æ—â—å`.

## Portfolio Copilot (MVP)
–ò—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø–æ—Ä—Ç—Ñ–µ–ª—è –¥–ª—è Copilot —è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª `portfolio_state.json` (–Ω–µ SQLite).
–î–ª—è Render Free —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `COPILOT_STORAGE_BACKEND=redis`, —Ç–æ–≥–¥–∞ Copilot —Ö—Ä–∞–Ω–∏—Ç state/settings/logs –≤ Upstash Redis –∏ –Ω–µ —Ç–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ.
–î–∞–Ω–Ω—ã–µ Copilot –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ `user_id` (–ø–æ—Ä—Ç—Ñ–µ–ª—å/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏/–º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã).

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è (–ø—Ä–æ—Ç–æ–∫–æ–ª)
- `/portfolio_set` + –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π snapshot (`TICKER QTY PRICE`), –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å–æ—Å—Ç–∞–≤–∞.
- `/portfolio_add TICKER QTY PRICE` (–¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è weighted avg).
- `/portfolio_reduce TICKER QTY` (–∑–∞–ø—Ä–µ—â–µ–Ω–æ —É–º–µ–Ω—å—à–∞—Ç—å –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ qty).
- `/portfolio_remove TICKER`
- `/portfolio_update_avg TICKER PRICE`
- `/watchlist_add TICKER`
- `/watchlist_remove TICKER`
- `/portfolio_show`

–ü–æ—Å–ª–µ –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏:
- –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `portfolio_version`;
- –ø–∏—à–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `change_log` (timestamp, action, ticker, qty, old_value, new_value).

### –ö–æ–º–∞–Ω–¥—ã Copilot
- `/copilot_status` - —Å—Ç–∞—Ç—É—Å, –ø—Ä–æ—Ñ–∏–ª—å, guardrails.
- `/copilot_recommendations` - —Ç–µ–∫—É—â–∏–µ –∏–¥–µ–∏ —Å confidence/risk/suggested_size –∏ `portfolio_version`.
- `/copilot_metrics` - learning –º–µ—Ç—Ä–∏–∫–∏: hit-rate, precision@k, false-positive-rate, drawdown-impact proxy, usefulness score.
- `/copilot_settings` - –ø—Ä–æ—Å–º–æ—Ç—Ä/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- `/copilot_help` - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º Copilot-–∫–æ–º–∞–Ω–¥–∞–º.

–ü—Ä–∏–º–µ—Ä—ã `/copilot_settings`:
- `/copilot_settings show`
- `/copilot_settings kill_switch on`
- `/copilot_settings stress on`
- `/copilot_settings profile conservative`
- `/copilot_settings max_alerts 6`
- `/copilot_settings cooldown 240`
- `/copilot_settings fx_gbpusd 1.27`
- `/copilot_settings target_set SSLN 12`
- `/copilot_settings target_remove SSLN`
- `/copilot_settings promotion_size_pct 3`
- `/copilot_settings promotion_max_new 2`
- `/copilot_settings whitelist_add AMZN`
- `/copilot_settings blacklist_add MRNA`

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –í—Å–µ–≥–¥–∞ human-in-the-loop: –±–æ—Ç –Ω–µ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ä–¥–µ—Ä–∞.
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–ª–∏ confidence –Ω–∏–∑–∫–∏–π, Copilot –≤—ã–¥–∞–µ—Ç `HOLD` –∏ —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
- `/copilot_recommendations` —Å–æ–¥–µ—Ä–∂–∏—Ç 2 –±–ª–æ–∫–∞: `Portfolio Actions` –∏ `Watchlist Candidates` (BUY/HOLD –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –∏–∑ watchlist, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ).
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: `info` / `warning` / `urgent`.
- Anti-spam: dedup + cooldown + –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç.
- Risk guardrails: kill switch, concentration limits, whitelist/blacklist, market stress mode.

## –í–∞–∂–Ω–æ
- –≠—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π/—É—á–µ–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, –∞ –Ω–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è.
- –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—è–Ω—É—Ç—Å—è —á–µ—Ä–µ–∑ `yfinance`.
- –ï—Å–ª–∏ `OPENAI_API_KEY` –Ω–µ –∑–∞–¥–∞–Ω, –±–æ—Ç –¥–µ–ª–∞–µ—Ç –±–∞–∑–æ–≤—ã–π –æ–±–∑–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –±–µ–∑ LLM.
